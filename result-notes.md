On Ryzen 3900X 



## As downloaded 
```
GRPC_BENCHMARK_DURATION=300s
GRPC_SERVER_CPUS=<1-3>
GRPC_SERVER_RAM=512m
GRPC_CLIENT_CONNECTIONS=5
GRPC_CLIENT_CONCURRENCY=50
GRPC_CLIENT_QPS=0
GRPC_CLIENT_CPUS=9
GRPC_REQUEST_PAYLOAD=100B
```
note: updated to `GRPC_BENCHMARK_DURATION=30s`

### CPUs = 1
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_st      |   65177 |        0.73 ms |        1.01 ms |        1.10 ms |        1.42 ms |  101.09% |      4.72 MiB |
| java_grpc_pgc      |   56113 |        0.86 ms |        1.06 ms |        1.30 ms |        2.42 ms |   99.44% |    128.74 MiB |
| dotnet_grpc        |   34399 |        1.42 ms |        1.36 ms |        1.53 ms |       22.09 ms |  101.19% |    100.88 MiB |
| rust_tonic_mt      |   10006 |        4.94 ms |        1.17 ms |        4.58 ms |       88.72 ms |  101.54% |     12.37 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```

### CPUs = 2
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_st      |   65246 |        0.73 ms |        1.01 ms |        1.10 ms |        1.38 ms |   98.71% |      4.75 MiB |
| java_grpc_pgc      |   64079 |        0.73 ms |        0.82 ms |        1.07 ms |        3.36 ms |  157.39% |    153.47 MiB |
| dotnet_grpc        |   51601 |        0.93 ms |        0.96 ms |        1.10 ms |        6.08 ms |  197.26% |    116.15 MiB |
| rust_tonic_mt      |   19658 |        2.49 ms |        1.08 ms |        1.41 ms |       75.26 ms |  198.11% |     10.78 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```

### CPUs = 3
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_st      |   65172 |        0.73 ms |        1.01 ms |        1.10 ms |        1.39 ms |  100.36% |       4.8 MiB |
| dotnet_grpc        |   64115 |        0.74 ms |        0.86 ms |        0.99 ms |        2.56 ms |   299.7% |    102.13 MiB |
| java_grpc_pgc      |   59295 |        0.79 ms |        0.73 ms |        1.06 ms |        4.28 ms |  198.85% |    158.57 MiB |
| rust_tonic_mt      |   29682 |        1.63 ms |        1.05 ms |        1.32 ms |       60.33 ms |   305.8% |     12.61 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```


## With `target-cpu=native`

### CPUs = 1
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_st      |   65736 |        0.73 ms |        1.01 ms |        1.10 ms |        1.43 ms |   98.89% |      4.81 MiB |
| rust_tonic_mt      |   10240 |        4.83 ms |        1.17 ms |        2.78 ms |       88.53 ms |  100.09% |     12.54 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```


### CPUs = 2
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_st      |   65249 |        0.73 ms |        1.00 ms |        1.09 ms |        1.38 ms |  100.46% |      4.76 MiB |
| rust_tonic_mt      |   20250 |        2.42 ms |        1.07 ms |        1.39 ms |       74.57 ms |  197.22% |     10.78 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```

## With limiting threads on rust-mt

I have a 24-thread machine, and Docker doesn't tell the container about the limit.

`CPUs = 2, threads 2`
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_mt      |   62846 |        0.76 ms |        1.17 ms |        1.32 ms |        1.67 ms |  193.71% |      3.22 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```

`CPUs = 1, threads 2` -- bad because we're telling tonic about 2 CPUs but we only have one available
```
--------------------------------------------------------------------------------------------------------------------------------
| name               |   req/s |   avg. latency |        90 % in |        95 % in |        99 % in | avg. cpu |   avg. memory |
--------------------------------------------------------------------------------------------------------------------------------
| rust_tonic_mt      |   32808 |        1.49 ms |        1.24 ms |        1.44 ms |       47.62 ms |  101.29% |      3.14 MiB |
--------------------------------------------------------------------------------------------------------------------------------
```

